(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16f38a0c"],{5204:function(t,o,n){},6706:function(t,o,n){"use strict";var s=n("6c20"),i=n.n(s);i.a},"6c20":function(t,o,n){},"89db":function(t,o,n){"use strict";var s=n("5204"),i=n.n(s);i.a},f4b8:function(t,o,n){"use strict";n.r(o);var s=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{attrs:{id:"app"}},[n("modal-window",{staticStyle:{"z-index":"100"},attrs:{width:"25rem","no-padding":!0},model:{value:t.showAjaxErrorsModal,callback:function(o){t.showAjaxErrorsModal=o},expression:"showAjaxErrorsModal"}},[n("div",{attrs:{slot:"main"},slot:"main"},t._l(this.$store.state.ajaxErrors,(function(o){return n("p",{key:o,staticStyle:{margin:"1rem"}},[t._v(t._s(o))])})),0),n("button",{ref:"ajaxErrorsModalButton",staticClass:"button button--modal",attrs:{slot:"footer"},on:{click:function(o){t.showAjaxErrorsModal=!1}},slot:"footer"},[t._v(" OK ")])]),n("modal-window",{attrs:{"no-padding":!0,"hide-footer":!0},on:{input:t.closeAccountModal},model:{value:t.showAccountModal,callback:function(o){t.showAccountModal=o},expression:"showAccountModal"}},[n("tab-view",{attrs:{slot:"main",tabs:["Авторизация"],padding:"true"},slot:"main",model:{value:t.showAccountTab,callback:function(o){t.showAccountTab=o},expression:"showAccountTab"}},[n("template",{slot:"Авторизация"},[n("form",{on:{submit:function(o){return o.preventDefault(),t.doLogin(o)}}},[n("fancy-input",{attrs:{error:t.login.errors.username,placeholder:"Логин",width:"100%"},model:{value:t.login.username,callback:function(o){t.$set(t.login,"username",o)},expression:"login.username"}}),n("fancy-input",{attrs:{error:t.login.errors.hash,placeholder:"Пароль",type:"password",width:"100%"},model:{value:t.login.password,callback:function(o){t.$set(t.login,"password",o)},expression:"login.password"}}),n("div",{staticStyle:{"margin-top":"0.5rem"}},[n("loading-button",{staticClass:"button button--green button--margin",attrs:{loading:t.login.loading},on:{click:t.doLogin}},[n("font-awesome-icon",{staticStyle:{"margin-right":"0.25rem"},attrs:{icon:["fa","unlock-alt"]}}),t._v(" Войти ")],1),n("div",{staticClass:"button button--borderless",on:{click:t.closeAccountModal}},[t._v(" Отмена ")])],1)],1)])],2)],1),n("header",{staticClass:"header"},[n("div",{staticClass:"header__group"},[n("router-link",{staticClass:"logo",attrs:{to:"/"}},[t._v(t._s(t.name))])],1),n("div",{staticClass:"header__group",class:{"header__group--show":t.showMenu}},[t.$store.state.username?[n("notification-button"),t.$store.state.admin?n("router-link",{staticClass:"button button--thin_text",attrs:{to:"/admin"}},[t._v(" Панель администратора ")]):t._e(),n("router-link",{staticClass:"button button--thin_text",attrs:{to:"/settings"}},[t._v(" Настройки пользователя ")]),n("loading-button",{staticClass:"button--thin_text",attrs:{loading:t.loadingLogout},on:{click:t.logout}},[t._v(" Выход ")])]:[n("div",{staticClass:"button button--thin_text",on:{click:function(o){return t.showAccountModalTab(0)}}},[t._v(" Войти ")])]],2),n("div",{staticClass:"header__overlay",class:{"header__overlay--show":t.showMenu},on:{click:t.toggleMenu}}),n("span",{staticClass:"header__menu_button",on:{click:t.toggleMenu}},[n("font-awesome-icon",{attrs:{icon:["fa","bars"]}})],1)]),n("not-found",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.show404Page,expression:"$store.state.show404Page"}]}),n("transition",{attrs:{name:"fade"}},[n("router-view",{directives:[{name:"show",rawName:"v-show",value:!t.$store.state.show404Page,expression:"!$store.state.show404Page"}]})],1)],1)},i=[],e=(n("7db0"),n("b0c0"),n("498a"),n("6307")),a=n("6334"),r=n("80e3"),c=n("8e8d"),u=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"notification_button"},[n("div",{staticClass:"notification_button__overlay",class:{"notification_button__overlay--show":t.showMenu},on:{click:function(o){return t.setShowMenu(!1)}}}),n("button",{staticClass:"button notification_button__button",class:{"notification_button__button--shake":t.shake},on:{click:function(o){return t.setShowMenu(!t.showMenu)}}},[n("font-awesome-icon",{staticClass:"notification_button__button__icon",attrs:{icon:["far","bell"]}}),n("span",{staticClass:"notification_button__button__count",class:{"notification_button__button__count--none":!t.unreadCount,"notification_button__button__count--two_figure":t.unreadCount>9,"notification_button__button__count--three_figure":t.unreadCount>99}},[t._v(t._s(t.unreadCountText))])],1),n("div",{staticClass:"notification_button__menu_group",class:{"notification_button__menu_group--show":t.showMenu}},[n("div",{staticClass:"notification_button__triangle"}),n("div",{staticClass:"notification_button__menu"},[t._l(t.postNotifications,(function(o,s){return n("div",{key:"notification-"+s,staticClass:"notification_button__menu__item",class:{"notification_button__menu__item--uninteracted":!o.interacted,"notification_button__menu__item--no_border":s>2},on:{click:function(n){return t.click(o)}}},[n("div",{staticClass:"notification_button__menu__item__header"},["mention"===o.type?n("span",[t._v("New mention")]):"reply"===o.type?n("span",[t._v("Reply to your post")]):t._e(),n("span",[n("span",{staticClass:"notification_button__menu__item__header__date"},[t._v(t._s(t._f("formatDate")(o.createdAt)))]),n("span",{staticClass:"notification_button__menu__item__header__close",on:{click:function(n){return n.stopPropagation(),t.deleteNotification(o.id)}}},[t._v("×")])])]),n("div",[t.isYouOrDeleted(o.PostNotification.User)?n("span",[t._v(" "+t._s(o.PostNotification.User?"You":"[deleted]")+" ")]):n("span",{staticClass:"notification_button__menu__item__link"},[t._v(" "+t._s(o.PostNotification.User.username)+" ")]),t._v(' wrote "'+t._s(t._f("truncate")(t._f("stripTags")(o.PostNotification.Post.content),50))+'" ')])])})),t.notifications.length?t._e():n("div",{staticClass:"notification_button__menu__empty"},[n("span",[t._v(t._s(t.emojis[t.emojiIndex%6]))]),t._v(" No notifications ")])],2)])])},l=[],d=(n("4de4"),n("4160"),n("a434"),n("159b"),n("4795"),n("c4b0")),h=n.n(d),f={name:"NotificationButton",data:function(){return{unreadCount:0,notifications:[],showMenu:!1,shake:!1,emojis:["😢","🤷","😘","😒","😔","💩"],emojiIndex:Math.round(5*Math.random())}},computed:{unreadCountText:function(){return this.unreadCount>99?"99+":this.unreadCount},postNotifications:function(){return this.notifications.filter((function(t){return t.PostNotification.Post}))}},methods:{isYouOrDeleted:function(t){return!t||t.username===this.$store.state.username},setShowMenu:function(t){var o=this;this.showMenu=t,t?this.resetUnreadCount():setTimeout((function(){o.emojiIndex++}),200)},getIndexById:function(t){var o;return this.notifications.forEach((function(n,s){n.id===t&&(o=s)})),o},getNotifications:function(){var t=this;this.axios.get("/api/v1/notification").then((function(o){t.notifications=o.data.Notifications,t.unreadCount=o.data.unreadCount}))["catch"](h()(this.$store))},resetUnreadCount:function(){var t=this;this.axios.put("/api/v1/notification").then((function(){t.unreadCount=0}))["catch"](h()(this.$store))},deleteNotification:function(t){var o=this,n=this.getIndexById(t);this.axios["delete"]("/api/v1/notification/"+t).then((function(){o.notifications.splice(n,1)}))["catch"](h()(this.$store))},setInteracted:function(t){var o=this,n=this.getIndexById(t),s=this.notifications[n];this.axios.put("/api/v1/notification/"+t).then((function(){o.$set(o.notifications,n,Object.assign(s,{interacted:!0}))}))["catch"](h()(this.$store))},click:function(t){t.interacted||this.setInteracted(t.id),("mention"===t.type||"reply"===t.type||"reply"===t.type)&&this.$router.push("/p/"+t.PostNotification.Post.id),this.setShowMenu(!1)}},created:function(){var t=this;this.$store.state.username&&this.getNotifications(),this.$socket.on("notification",(function(o){t.unreadCount++,t.notifications.unshift(o),t.shake=!0,setTimeout((function(){t.shake=!1}),1e3)}))},watch:{"$store.state.username":"getNotifications"}},m=f,_=(n("6706"),n("2877")),g=Object(_["a"])(m,u,l,!1,null,"bb99b6f4",null),p=g.exports,v=n("1b9a"),w={name:"app",components:{ModalWindow:e["a"],TabView:a["a"],FancyInput:r["a"],LoadingButton:c["a"],NotificationButton:p,NotFound:v["a"]},data:function(){return{signup:{username:"",password:"",confirmPassword:"",loading:!1,errors:{username:"",hash:"",confirmPassword:""}},login:{username:"",password:"",loading:!1,errors:{username:"",hash:""}},loadingLogout:!1,showMenu:!1,ajaxErrorHandler:h()(this.$store)}},computed:{name:function(){return this.$store.state.meta.name},showAccountModal:{get:function(){return this.$store.state.accountModal},set:function(t){this.$store.commit("setAccountModalState",t)}},showAjaxErrorsModal:{get:function(){return this.$store.state.ajaxErrorsModal},set:function(t){this.$store.commit("setAjaxErrorsModalState",t)}},showAccountTab:{get:function(){return this.$store.state.accountTabs},set:function(t){this.$store.commit("setAccountTabs",t)}},categories:function(){return this.$store.state.meta.categories}},methods:{showAccountModalTab:function(t){this.toggleMenu(),this.showAccountModal=!0,this.showAccountTab=t},toggleMenu:function(){this.showMenu=!this.showMenu},logout:function(){var t=this;this.toggleMenu(),this.loadingLogout=!0,this.axios.post("/api/v1/user/"+this.$store.state.username+"/logout").then((function(o){t.loadingLogout=!1,t.$store.commit("setUsername",""),t.$store.commit("setAdmin",o.data.admin),t.$socket.emit("accountEvent"),t.$router.push("/")}))["catch"]((function(o){t.loadingLogout=!1,t.ajaxErrorHandler(o),t.axios.post("/api/v1/user/"+t.$store.state.username+"/logout").then((function(o){t.loadingLogout=!1,t.$store.commit("setUsername",""),t.$store.commit("setAdmin",o.data.admin),t.$socket.emit("accountEvent"),t.$router.push("/")}))}))},clearSignup:function(){this.signup.username="",this.signup.password="",this.signup.confirmPassword="",this.$store.commit("setToken",null)},clearSignupErrors:function(){this.signup.errors.username="",this.signup.errors.hash="",this.signup.errors.confirmPassword=""},clearLogin:function(){this.login.username="",this.login.password=""},clearLoginErrors:function(){this.login.errors.username="",this.login.errors.hash=""},closeAccountModal:function(){this.showAccountModal=!1,this.clearLogin(),this.clearSignup(),this.clearLoginErrors(),this.clearSignupErrors()},createAccount:function(){var t=this;this.clearSignupErrors();var o={username:this.signup.username,password:this.signup.password};this.$store.state.token&&(o.admin=!0,o.token=this.$store.state.token),this.signup.password!==this.signup.confirmPassword?this.signup.errors.confirmPassword="Passwords must match":(this.signup.loading=!0,this.axios.post("/api/v1/user",o).then((function(o){t.signup.loading=!1,t.$store.commit("setUsername",o.data.username),t.$store.commit("setAdmin",o.data.admin),t.closeAccountModal(),t.$socket.emit("accountEvent")}))["catch"]((function(o){t.signup.loading=!1,t.ajaxErrorHandler(o,(function(o){var n=o.path;void 0!==t.signup.errors[n]&&void 0!==t.signup.errors[n]&&(t.signup.errors[n]=o.message)}))})))},doLogin:function(){var t=this;this.clearSignupErrors(),this.login.username.trim().length?(this.login.loading=!0,this.axios.post("/api/v1/user/".concat(this.login.username,"/login"),{password:this.login.password}).then((function(o){t.login.loading=!1,t.$store.commit("setUsername",o.data.username),t.$store.commit("setAdmin",o.data.admin),t.closeAccountModal(),t.$socket.emit("accountEvent"),t.$router.push("/admin/contacts")}))["catch"]((function(o){t.login.loading=!1,t.ajaxErrorHandler(o,(function(o){var n=o.path;void 0!==t.signup.errors[n]&&void 0!==t.signup.errors[n]&&(t.signup.errors[n]=o.message)}))}))):this.login.errors.username="Username must not be blank"}},created:function(){var t=this;this.axios.get("/api/v1/settings").then((function(o){t.$store.commit("setSettings",o.data),t.$store.dispatch("setTitle",t.$store.state.meta.title)}))["catch"]((function(o){"noSettings"===o.response.data.errors[0].name?t.$router.push("/start"):t.ajaxErrorHandler(o)})),this.axios.get("/api/v1/category").then((function(o){if(t.$store.commit("addCategories",o.data),!t.$store.state.meta.title.length&&t.$route.params.category){var n=t.$route.params.category.toUpperCase(),s=t.categories.find((function(t){return t.value===n}));t.$store.dispatch("setTitle",s.name)}}))["catch"](this.ajaxErrorHandler)},watch:{$route:function(){this.showMenu=!1},"$store.state.ajaxErrorsModal":function(t){t&&this.$refs.ajaxErrorsModalButton.focus()}}},b=w,$=(n("89db"),Object(_["a"])(b,s,i,!1,null,null,null));o["default"]=$.exports}}]);
//# sourceMappingURL=chunk-16f38a0c.043caf64.js.map